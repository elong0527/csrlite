---
title: "Adverse Event Analysis"
---

::: {.callout-note}
## Objectives

Generate adverse event analysis outputs following ROD:
:::

## Setup

First, let's import the required packages and load our study plan.

```{python}
#| message: false
import sys
from pathlib import Path
import polars as pl

# Add src to path for imports
sys.path.insert(0, str(Path.cwd().parent / 'src'))
```

```{python}
from tlfyaml import load_plan, ae_summary, ae_specific, ae_listing
```

## Load Study Plan

The study plan is defined in YAML format with template inheritance. It contains population definitions, observation periods, parameters, and data source specifications.

```{python}
# Load study plan from YAML
study_plan = load_plan("../examples/yaml/plan_xyz123.yaml")
```

## Generate AE Summary Table

The `ae_summary()` function generates summary tables with counts and percentages by treatment group.

```{python}
# Generate AE summary for treatment-emergent AEs
result_summary = ae_summary(
    study_plan=study_plan,
    population="apat",        # All Participants As Treated
    observation=None,         # All observations (no time restriction)
    parameter="any",          # Any adverse event
    group="trt01a"           # Treatment group variable
)

result_summary
```

### Display Metadata

```{python}
print("Analysis Metadata:")
for key, value in result_summary["meta"].items():
    print(f"  {key}: {value}")
```

### Population Denominators

The denominators show the number of subjects in each treatment group.

```{python}
result_summary["n_pop"]
```

### AE Summary Results

The summary table shows both SOC-level and PT-level counts with percentages. Results are sorted by frequency (highest to lowest).

```{python}
result_summary["summary"]
```

## Generate Specific AE Analysis

The `ae_specific()` function provides detailed analysis of specific adverse events with hierarchical SOCâ†’PT breakdown. It includes optional severity stratification.

```{python}
# Generate specific AE analysis for related AEs
result_specific = ae_specific(
    study_plan=study_plan,
    population="apat",
    observation=None,
    parameter="any",          # Use "any" instead of "rel" to show more results
    group="trt01a"
)
```

### Specific AE Results

```{python}
result_specific
```

```{python}
result_specific["summary"]
```

### Severity Breakdown

If severity data is available, the function provides stratification by severity grade.

```{python}
result_specific["severity"].head(10)
```

## Generate AE Listing

The `ae_listing()` function creates patient-level listings with demographics merged from ADSL and clinical details from ADAE.

```{python}
# Generate listing for serious AEs
result_listing = ae_listing(
    study_plan=study_plan,
    population="apat",
    observation=None,
    parameter="ser",          # Serious adverse events only
    sort_by=["TRTA", "USUBJID", "ASTDY"]
)
```

### Listing Metadata and Column Labels

```{python}
result_listing["column_labels"]
```
